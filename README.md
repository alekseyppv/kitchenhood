# Kitchen Hood ESPHome (ESP32-C3)

Готовая конфигурация ESPHome для кухонной вытяжки на **ESP32-C3** и 4-канальном SSR.

## Что делает проект

- Управляет тремя скоростями вытяжки:
  - Скорость 1 → реле `GPIO12`, кнопка `GPIO06`
  - Скорость 2 → реле `GPIO18`, кнопка `GPIO10`
  - Скорость 3 → реле `GPIO19`, кнопка `GPIO03`
- Управляет светом:
  - Свет → реле `GPIO11`, кнопка `GPIO02`
- Отдельная кнопка «выключить режимы»:
  - Кнопка №1 → `GPIO07`
- В Home Assistant отображаются:
  - состояния всех реле,
  - статусы всех физических кнопок,
  - кнопка **«Вытяжка: выключить все режимы»**.

## Логика работы

- Скорости взаимоисключающие: одновременно может быть включена только одна.
- При включении одной скорости остальные автоматически выключаются.
- Если нажать кнопку уже активной скорости, состояние не меняется.
- Кнопка «выключить режимы» выключает только скорости (свет не трогает).

## Файлы

- Основная конфигурация: `kitchenhood_esp32c3.yaml`

## Быстрый старт

1. Скопируйте YAML в вашу ESPHome-конфигурацию.
2. Создайте `secrets.yaml` (или используйте существующий) и добавьте:
   - `wifi_ssid`
   - `wifi_password`
   - `fallback_ap_password`
3. Прошейте устройство.
4. Добавьте устройство в Home Assistant через ESPHome API.

## Защита электроники (почему это важно)

При отключении асинхронного двигателя возникают:
- импульсы до ~600–1500 В,
- ВЧ-помехи,
- кратковременная просадка питания.

Без защиты это может вызывать:
- перезагрузку ESP,
- отвал Wi‑Fi,
- ложные срабатывания реле,
- деградацию/выход из строя блока питания.

Поэтому применена многоуровневая защита:

1. **RC-снаббер на двигателе** (X2 0.1 µF + ~55–100 Ω) — снижает выбросы и радиопомехи у источника.
2. **Варистор MOV-471 (07D471K) на входе БП** — гасит высоковольтные пики сети.
3. **Электролит 3300 µF по 5V питанию ESP** — компенсирует кратковременные просадки.
4. **Керамика 0.1 µF по питанию ESP** — подавляет быстрые ВЧ-помехи.
5. **Коммутация только фазы через SSR** — уменьшает паразитные токи и наводки.
6. **Логическая блокировка скоростей в прошивке** — исключает одновременное включение обмоток.

> ⚠️ Работа с 220 В опасна. Соблюдайте электробезопасность и используйте компоненты с нужным классом и запасом по напряжению/мощности.
